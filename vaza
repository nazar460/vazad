from flask import Flask, render_template_string, request, session, redirect, url_for, jsonify
import json
from datetime import datetime
import os

app = Flask(__name__)
app.secret_key = 'your-secret-key-here-change-in-production'

# –§–∞–π–ª –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
USERS_FILE = 'users_clean.json'


# –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
def load_users():
    if os.path.exists(USERS_FILE):
        try:
            with open(USERS_FILE, 'r', encoding='utf-8') as f:
                return json.load(f)
        except:
            return []
    return []


# –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
def save_users(users):
    with open(USERS_FILE, 'w', encoding='utf-8') as f:
        json.dump(users, f, ensure_ascii=False, indent=2)


# –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
def add_user(name, email):
    users = load_users()

    for user in users:
        if user.get('email') == email:
            if user['name'] != name:
                user['name'] = name
                save_users(users)
            return

    new_user = {
        'name': name,
        'email': email,
        'registered_at': datetime.now().strftime('%Y-%m-%d %H:%M:%S')
    }
    users.append(new_user)
    save_users(users)


# –ë–ê–ó–ê –ü–ò–¢–ê–ù–¨ (100 –∑–∞–ø–∏—Ç–∞–Ω—å)
QUESTIONS = [
    # --- –Ü–°–ù–£–Æ–ß–Ü –ü–ò–¢–ê–ù–ù–Ø (IDs 1-50) ---
    {"id": 1, "question": "–©–æ —Ç–∞–∫–µ '–±–∞–Ω—è–∫'?", "options": ["–õ–∞–∑–Ω—è", "–ö–∞—Å—Ç—Ä—É–ª—è", "–ë–∞–Ω–∫–∞"], "answer": "–ö–∞—Å—Ç—Ä—É–ª—è"},
    {"id": 2, "question": "–©–æ —Ç–∞–∫–µ '–ª—é—Å—Ç—Ä–æ'?", "options": ["–î–∑–µ—Ä–∫–∞–ª–æ", "–õ—é—Å—Ç—Ä–∞", "–í—ñ–∫–Ω–æ"], "answer": "–î–∑–µ—Ä–∫–∞–ª–æ"},
    {"id": 3, "question": "–©–æ –æ–∑–Ω–∞—á–∞—î —Å–ª–æ–≤–æ '—à—É—Ñ–ª—è'?", "options": ["–®—É—Ö–ª—è–¥–∞", "–õ–æ–ø–∞—Ç–∞", "–®–∞—Ñ–∞"], "answer": "–õ–æ–ø–∞—Ç–∞"},
    {"id": 4, "question": "–•—Ç–æ —Ç–∞–∫–∞ '–∫–æ–±—ñ—Ç–∞'?", "options": ["–ñ—ñ–Ω–∫–∞", "–ö–æ–±–∏–ª–∞", "–ö—ñ–º–Ω–∞—Ç–∞"], "answer": "–ñ—ñ–Ω–∫–∞"},
    {"id": 5, "question": "–©–æ —Ç–∞–∫–µ '—Ä–∏–Ω–≤–∞'?", "options": ["–†—ñ–≤–Ω–∏–Ω–∞", "–í–æ–¥–æ—Å—Ç—ñ—á–Ω–∞ —Ç—Ä—É–±–∞", "–†–∏–Ω–æ–∫"],
     "answer": "–í–æ–¥–æ—Å—Ç—ñ—á–Ω–∞ —Ç—Ä—É–±–∞"},
    {"id": 6, "question": "–©–æ —Ç–∞–∫–µ '–≥–∞–ª—å–±–∞'?", "options": ["–ì–∞–ª—å–º–æ", "–ü–∏–≤–Ω–∏–π –∫—É—Ö–æ–ª—å", "–®–∞—Ä—Ñ"],
     "answer": "–ü–∏–≤–Ω–∏–π –∫—É—Ö–æ–ª—å"},
    {"id": 7, "question": "–©–æ –æ–∑–Ω–∞—á–∞—î '—Ç—Ä–∞—Ñ—É–Ω–æ–∫'?", "options": ["–ü–æ–¥–∞—Ä—É–Ω–æ–∫", "–í–∏–ø–∞–¥–æ–∫/–ü—Ä–∏–≥–æ–¥–∞", "–¢—Ä–∞–≤–∞"],
     "answer": "–í–∏–ø–∞–¥–æ–∫/–ü—Ä–∏–≥–æ–¥–∞"},
    {"id": 8, "question": "–©–æ —Ç–∞–∫–µ '–∫–∞–º—ñ–∑–µ–ª—å–∫–∞'?", "options": ["–ö–∞–º—ñ–Ω—å", "–ñ–∏–ª–µ—Ç", "–°–æ—Ä–æ—á–∫–∞"], "answer": "–ñ–∏–ª–µ—Ç"},
    {"id": 9, "question": "–©–æ —Ç–∞–∫–µ '–ø–ª—è—Ü'?", "options": ["–ü–ª—è–∂", "–ü–ª–æ—â–∞/–ú—ñ—Å—Ü–µ", "–ü–∏—Ä—ñ–≥"], "answer": "–ü–ª–æ—â–∞/–ú—ñ—Å—Ü–µ"},
    {"id": 10, "question": "–Ø–∫—â–æ —Ö—Ç–æ—Å—å –∫—Ä–∏—á–∏—Ç—å '“ë–≤–∞–ª—Ç', —â–æ —Ü–µ?",
     "options": ["–ü—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è", "–ö—Ä–∏–∫ –ø—Ä–æ –¥–æ–ø–æ–º–æ–≥—É/–ì–∞–ª–∞—Å", "–°–º—ñ—Ö"], "answer": "–ö—Ä–∏–∫ –ø—Ä–æ –¥–æ–ø–æ–º–æ–≥—É/–ì–∞–ª–∞—Å"},
    {"id": 11, "question": "–©–æ —Ç–∞–∫–µ '–∫–Ω–∞–π–ø–∞'?", "options": ["–ú–∞–≥–∞–∑–∏–Ω", "–ö–∞—Ñ–µ/–†–µ—Å—Ç–æ—Ä–∞–Ω", "–ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞"],
     "answer": "–ö–∞—Ñ–µ/–†–µ—Å—Ç–æ—Ä–∞–Ω"},
    {"id": 12, "question": "–©–æ –æ–∑–Ω–∞—á–∞—î —Å–ª–æ–≤–æ '–ø'—î—Ü'?", "options": ["–ü—ñ—á", "–ü–µ—Å", "–ü'—è–Ω–∏—Ü—è"], "answer": "–ü—ñ—á"},
    {"id": 13, "question": "–•—Ç–æ —Ç–∞–∫–∏–π '–±–∞—Ç—è—Ä'?", "options": ["–ü–æ–ª—ñ—Ü–µ–π—Å—å–∫–∏–π", "–í–µ—Å–µ–ª–∏–π —Ö—É–ª—ñ–≥–∞–Ω/–ì—É–ª—å–≤—ñ—Å–∞", "–°–≤—è—â–µ–Ω–∏–∫"],
     "answer": "–í–µ—Å–µ–ª–∏–π —Ö—É–ª—ñ–≥–∞–Ω/–ì—É–ª—å–≤—ñ—Å–∞"},
    {"id": 14, "question": "–©–æ —Ç–∞–∫–µ '–ø–ª—è—Ü–æ–∫'?", "options": ["–ü–∏—Ä—ñ–≥/–¢–æ—Ä—Ç", "–ü–ª—è—à–∫–∞", "–ü–ª–æ—â–∞"], "answer": "–ü–∏—Ä—ñ–≥/–¢–æ—Ä—Ç"},
    {"id": 15, "question": "–•—Ç–æ —Ç–∞–∫–∞ '—Ü—å–æ—Ü—è'?", "options": ["–ë–∞–±—É—Å—è", "–¢—ñ—Ç–∫–∞", "–°–µ—Å—Ç—Ä–∞"], "answer": "–¢—ñ—Ç–∫–∞"},
    {"id": 16, "question": "–ö–æ–≥–æ –Ω–∞–∑–∏–≤–∞—é—Ç—å '–≤–∞—Ä'—è—Ç'?", "options": ["–õ—ñ–∫–∞—Ä", "–ë–æ–∂–µ–≤—ñ–ª—å–Ω–∏–π/–î–∏–≤–∞–∫", "–í–æ–¥—ñ–π"],
     "answer": "–ë–æ–∂–µ–≤—ñ–ª—å–Ω–∏–π/–î–∏–≤–∞–∫"},
    {"id": 17, "question": "–©–æ —Ç–∞–∫–µ '–∫–æ–≥—É—Ç'?", "options": ["–ü—ñ–≤–µ–Ω—å", "–ö—ñ—Ç", "–Ü–Ω–¥–∏–∫"], "answer": "–ü—ñ–≤–µ–Ω—å"},
    {"id": 18, "question": "–©–æ —Ç–∞–∫–µ '—à–º–∞—Ç–∞'?", "options": ["–°—É–∫–Ω—è", "–ì–∞–Ω—á—ñ—Ä–∫–∞", "–®–º–∞—Ç–æ–∫ —Ö–ª—ñ–±–∞"], "answer": "–ì–∞–Ω—á—ñ—Ä–∫–∞"},
    {"id": 19, "question": "–©–æ –æ–∑–Ω–∞—á–∞—î '—Ñ—Ä–∏–∑—É—Ä–∞'?", "options": ["–ó–∞—á—ñ—Å–∫–∞", "–ú–∞–Ω—ñ–∫—é—Ä", "–û–¥—è–≥"], "answer": "–ó–∞—á—ñ—Å–∫–∞"},
    {"id": 20, "question": "–©–æ —Ç–∞–∫–µ '–±—Ä–∞–º–∞'?", "options": ["–î–≤–µ—Ä—ñ/–í–æ—Ä–æ—Ç–∞", "–í—ñ–∫–Ω–æ", "–°—Ç—ñ–Ω–∞"], "answer": "–î–≤–µ—Ä—ñ/–í–æ—Ä–æ—Ç–∞"},
    {"id": 21, "question": "–Ø–∫ –Ω–∞ –¥—ñ–∞–ª–µ–∫—Ç—ñ —Å–∫–∞–∑–∞—Ç–∏ '—à—Ç–∞–Ω–∏'?", "options": ["–ì–∞—á—ñ", "–®—Ç–∞–Ω–∏", "–ú–µ—à—Ç–∏"], "answer": "–ì–∞—á—ñ"},
    {"id": 22, "question": "–©–æ —Ç–∞–∫–µ '—Ä–æ–≤–µ—Ä'?", "options": ["–ú–∞—à–∏–Ω–∞", "–í–µ–ª–æ—Å–∏–ø–µ–¥", "–ú–æ—Ç–æ—Ü–∏–∫–ª"], "answer": "–í–µ–ª–æ—Å–∏–ø–µ–¥"},
    {"id": 23, "question": "–Ø–∫ –Ω–∞–∑–∏–≤–∞—é—Ç—å –∫–∞—Ä—Ç–æ–ø–ª—é?", "options": ["–ë—É–ª—å–±–∞", "–ì—Ä—É—à–∫–∞", "–¶–∏–±—É–ª—è"], "answer": "–ë—É–ª—å–±–∞"},
    {"id": 24, "question": "–©–æ —Ç–∞–∫–µ '—Å—Ç—Ä–∏—Ö'?", "options": ["–ü—ñ–¥–≤–∞–ª", "–î–∞—Ö", "–ì–æ—Ä–∏—â–µ"], "answer": "–ì–æ—Ä–∏—â–µ"},
    {"id": 25, "question": "–Ø–∫—â–æ –ø—Ä–æ—Å—è—Ç—å –ø–æ–¥–∞—Ç–∏ '–ø–∞—Ç–µ–ª—å–Ω—é', —â–æ —Ü–µ?", "options": ["–ö–∞—Å—Ç—Ä—É–ª—è", "–°–∫–æ–≤–æ—Ä—ñ–¥–∫–∞", "–í–∏–¥–µ–ª–∫–∞"],
     "answer": "–°–∫–æ–≤–æ—Ä—ñ–¥–∫–∞"},
    {"id": 26, "question": "–©–æ —Ç–∞–∫–µ '–∑—É–ø–∞'?", "options": ["–°—É–ø", "–ö–∞—à–∞", "–ß–∞–π"], "answer": "–°—É–ø"},
    {"id": 27, "question": "–Ø–∫ –Ω–∞–∑–∏–≤–∞—é—Ç—å –ø–æ–ª—É–Ω–∏—Ü—é?", "options": ["–ú–∞–ª–∏–Ω–∞", "–¢—Ä—É—Å–∫–∞–≤–∫–∞", "–ê—Ñ–∏–Ω–∞"],
     "answer": "–¢—Ä—É—Å–∫–∞–≤–∫–∞"},
    {"id": 28, "question": "–•—Ç–æ —Ç–∞–∫–∏–π '–≤—É–π–∫–æ'?", "options": ["–î—è–¥—å–∫–æ", "–ë—Ä–∞—Ç", "–°—É—Å—ñ–¥"], "answer": "–î—è–¥—å–∫–æ"},
    {"id": 29, "question": "–©–æ –æ–∑–Ω–∞—á–∞—î —Å–ª–æ–≤–æ '—Ñ–∞–π–Ω–æ'?", "options": ["–ü–æ–≥–∞–Ω–æ", "–î–æ–±—Ä–µ", "–®–≤–∏–¥–∫–æ"], "answer": "–î–æ–±—Ä–µ"},
    {"id": 30, "question": "–©–æ —Ç–∞–∫–µ '–º–µ—à—Ç–∏'?", "options": ["–ß–µ—Ä–µ–≤–∏–∫–∏", "–®–∫–∞—Ä–ø–µ—Ç–∫–∏", "–†—É–∫–∞–≤–∏—Ü—ñ"], "answer": "–ß–µ—Ä–µ–≤–∏–∫–∏"},
    {"id": 31, "question": "–©–æ —Ç–∞–∫–µ '—Ñ—ñ–ª—ñ–∂–∞–Ω–∫–∞'?", "options": ["–¢–∞—Ä—ñ–ª–∫–∞", "–ß–∞—à–∫–∞", "–ü–ª—è—à–∫–∞"], "answer": "–ß–∞—à–∫–∞"},
    {"id": 32, "question": "–©–æ —Ö–æ–≤–∞—î—Ç—å—Å—è –∑–∞ —Å–ª–æ–≤–æ–º '—Å–ª–æ—ó–∫'?", "options": ["–°–∫–ª—è–Ω–∞ –±–∞–Ω–∫–∞", "–°—Ç—ñ–ª–µ—Ü—å", "–®–∞—Ä —Å–∞–ª–∞"],
     "answer": "–°–∫–ª—è–Ω–∞ –±–∞–Ω–∫–∞"},
    {"id": 33, "question": "–Ø–∫—â–æ –Ω–∞ –¥–≤–æ—Ä—ñ '–∑–∏–º–Ω–æ', —Ç–æ —Ç–∞–º...?", "options": ["–¢–µ–º–Ω–æ", "–•–æ–ª–æ–¥–Ω–æ", "–°–ª–∏–∑—å–∫–æ"],
     "answer": "–•–æ–ª–æ–¥–Ω–æ"},
    {"id": 34, "question": "–©–æ —Ç–∞–∫–µ '–∫–∞–Ω–∞–ø–∫–∞'?", "options": ["–î–∏–≤–∞–Ω", "–ë—É—Ç–µ—Ä–±—Ä–æ–¥", "–ü–æ–¥—É—à–∫–∞"], "answer": "–ë—É—Ç–µ—Ä–±—Ä–æ–¥"},
    {"id": 35, "question": "–•—Ç–æ —Ç–∞–∫–∞ '–∫–æ–ª—ñ–∂–∞–Ω–∫–∞'?", "options": ["–í—á–∏—Ç–µ–ª—å–∫–∞", "–°—É—Å—ñ–¥–∫–∞", "–ü–æ–¥—Ä—É–≥–∞"],
     "answer": "–ü–æ–¥—Ä—É–≥–∞"},
    {"id": 36, "question": "–©–æ —Ç–∞–∫–µ '–∫–æ—Ü–∏–∫'?", "options": ["–ö–æ—Ç–∏–∫", "–ö–∏–ª–∏–º–æ–∫/–ö–æ–≤–¥—Ä–∞", "–¶—É–∫–µ—Ä–∫–∞"],
     "answer": "–ö–∏–ª–∏–º–æ–∫/–ö–æ–≤–¥—Ä–∞"},
    {"id": 37, "question": "–©–æ –æ–∑–Ω–∞—á–∞—î '—à–ø–æ–Ω–¥–µ—Ä'?", "options": ["–°–∞–ª–æ –∑ –º'—è—Å–æ–º", "–®–ø—ñ–Ω–∞—Ç", "–ü–∞—Ä–∫–∞–Ω"],
     "answer": "–°–∞–ª–æ –∑ –º'—è—Å–æ–º"},
    {"id": 38, "question": "–©–æ —Ç–∞–∫–µ '–ø—É—Ç–Ω—è'?", "options": ["–î–æ—Ä–æ–≥–∞", "–í—ñ–¥—Ä–æ", "–ö–∞–ª—é–∂–∞"], "answer": "–í—ñ–¥—Ä–æ"},
    {"id": 39, "question": "–Ø–∫—â–æ —Ö—Ç–æ—Å—å –∫–∞–∂–µ '–∑–∞–∫–∞–ª—è–ø—É—Ü–∫–∞—Ç–∏', —â–æ –≤—ñ–Ω –∑—Ä–æ–±–∏–≤?",
     "options": ["–ó–∞–±—Ä—É–¥–Ω–∏–≤", "–ó'—ó–≤", "–ó–∞–≥—É–±–∏–≤"], "answer": "–ó–∞–±—Ä—É–¥–Ω–∏–≤"},
    {"id": 40, "question": "–©–æ —Ç–∞–∫–µ '–∑–∞–±–∞–≤–∞'?", "options": ["–ë—ñ–π–∫–∞", "–†–æ–±–æ—Ç–∞", "–°–≤—è—Ç–æ/–í–µ—á—ñ—Ä–∫–∞"],
     "answer": "–°–≤—è—Ç–æ/–í–µ—á—ñ—Ä–∫–∞"},
    {"id": 41, "question": "–©–æ —Ç–∞–∫–µ '–∫—É–ª—å—á–∏–∫–∏'?", "options": ["–ö—É–ª—å–∫–∏", "–°–µ—Ä–µ–∂–∫–∏", "–ö–ª—é—á—ñ"], "answer": "–°–µ—Ä–µ–∂–∫–∏"},
    {"id": 42, "question": "–©–æ —Ç–∞–∫–µ '–º–∞—Ä–∏–Ω–∞—Ä–∫–∞'?", "options": ["–ü—ñ–¥–∂–∞–∫", "–ú–∞—Ä–∏–Ω–æ–≤–∞–Ω–∏–π –æ–≥—ñ—Ä–æ–∫", "–°–æ—Ä–æ—á–∫–∞"],
     "answer": "–ü—ñ–¥–∂–∞–∫"},
    {"id": 43, "question": "–©–æ —Ç–∞–∫–µ '—Ñ—ñ—Ä–∞'?", "options": ["–ú–∞—à–∏–Ω–∞", "–í—ñ–∑", "–§—ñ—Ä–∞–Ω–∫–∞"], "answer": "–í—ñ–∑"},
    {"id": 44, "question": "–©–æ —Ç–∞–∫–µ '–∞–Ω–¥—Ä—É—Ç–∏'?", "options": ["–í–∞—Ñ–ª—ñ", "–¶—É–∫–µ—Ä–∫–∏", "–ü—Ä—è–Ω–∏–∫–∏"], "answer": "–í–∞—Ñ–ª—ñ"},
    {"id": 45, "question": "–©–æ —Ç–∞–∫–µ '–ø—É–¥–µ–ª–∫–æ'?", "options": ["–ü—É–¥—Ä–∞", "–ö–æ—Ä–æ–±–∫–∞", "–ü–æ–¥—É—à–∫–∞"], "answer": "–ö–æ—Ä–æ–±–∫–∞"},
    {"id": 46, "question": "–©–æ —Ç–∞–∫–µ '–æ–±—Ä—É—Å'?", "options": ["–†—É—à–Ω–∏–∫", "–°–∫–∞—Ç–µ—Ä—Ç–∏–Ω–∞", "–ö–∏–ª–∏–º"], "answer": "–°–∫–∞—Ç–µ—Ä—Ç–∏–Ω–∞"},
    {"id": 47, "question": "–©–æ —Ç–∞–∫–µ '—Ü–∏–Ω–∞–º–æ–Ω'?", "options": ["–õ–∏–º–æ–Ω", "–ö–æ—Ä–∏—Ü—è", "–¶–∏–±—É–ª—è"], "answer": "–ö–æ—Ä–∏—Ü—è"},
    {"id": 48, "question": "–©–æ —Ç–∞–∫–µ '—à–ª—è—Ñ—Ä–æ–∫'?", "options": ["–ö–∞–ø–µ–ª—é—Ö", "–•–∞–ª–∞—Ç", "–®–∞—Ä—Ñ"], "answer": "–•–∞–ª–∞—Ç"},
    {"id": 49, "question": "–©–æ –æ–∑–Ω–∞—á–∞—î '–¥–µ—Ñ—ñ–ª—è–¥–∞'?", "options": ["–°–≤–∞—Ä–∫–∞", "–ü—Ä–æ–≥—É–ª—è–Ω–∫–∞/–ü–∞—Ä–∞–¥", "–ß–µ—Ä–≥–∞"],
     "answer": "–ü—Ä–æ–≥—É–ª—è–Ω–∫–∞/–ü–∞—Ä–∞–¥"},
    {"id": 50, "question": "–©–æ —Ç–∞–∫–µ '–±—Ä–∞—Ç—Ä—É—Ä–∞'?", "options": ["–ë—Ä–∞—Ç", "–¢—Ä—É–±–∞", "–î—É—Ö–æ–≤–∫–∞"], "answer": "–î—É—Ö–æ–≤–∫–∞"},
    # --- –ù–û–í–Ü 50 –ó–ê–ü–ò–¢–ê–ù–¨ (IDs 51-100) ---
    {"id": 51, "question": "–©–æ —Ç–∞–∫–µ '–∞—Ñ–∏–Ω–∏'?", "options": ["–ß–æ—Ä–Ω–∏—Ü—ñ", "–ì—Ä–∏–±–∏", "–ú–∞—Å–ª–∏–Ω–∏"], "answer": "–ß–æ—Ä–Ω–∏—Ü—ñ"},
    {"id": 52, "question": "–©–æ —Ç–∞–∫–µ '–±–∞–º–±–µ—Ç–µ–ª—å'?",
     "options": ["–õ–∞–≤–∫–∞-–ª—ñ–∂–∫–æ", "–ú—É–∑–∏—á–Ω–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç", "–ë–∞–º–±—É–∫–æ–≤–∞ –ø–∞–ª–∏—Ü—è"], "answer": "–õ–∞–≤–∫–∞-–ª—ñ–∂–∫–æ"},
    {"id": 53, "question": "–©–æ —Ç–∞–∫–µ '–±—Ä–∏—Ç–≤–∞–Ω–∫–∞'?", "options": ["–ë—Ä–∏—Ç–≤–∞", "–§–æ—Ä–º–∞ –¥–ª—è –≤–∏–ø—ñ–∫–∞–Ω–Ω—è", "–ú–∞–ª–µ–Ω—å–∫–∞ –±—Ä–∏–≥–∞–¥–∞"],
     "answer": "–§–æ—Ä–º–∞ –¥–ª—è –≤–∏–ø—ñ–∫–∞–Ω–Ω—è"},
    {"id": 54, "question": "–©–æ —Ç–∞–∫–µ '–≤—ñ—Ö–æ—Ç—å'?", "options": ["–ë—É–∫–µ—Ç", "–ú–æ—á–∞–ª–∫–∞/–ì–∞–Ω—á—ñ—Ä–∫–∞", "–í–∏—Ö—ñ–¥"],
     "answer": "–ú–æ—á–∞–ª–∫–∞/–ì–∞–Ω—á—ñ—Ä–∫–∞"},
    {"id": 55, "question": "–•—Ç–æ —Ç–∞–∫–∞ '–≤—É–π–Ω–∞'?", "options": ["–î—è–¥–∏–Ω–∞ (–¥—Ä—É–∂–∏–Ω–∞ –≤—É–π–∫–∞)", "–í—ñ–π—Å—å–∫–æ–≤–∞", "–°—É—Å—ñ–¥–∫–∞"],
     "answer": "–î—è–¥–∏–Ω–∞ (–¥—Ä—É–∂–∏–Ω–∞ –≤—É–π–∫–∞)"},
    {"id": 56, "question": "–©–æ –æ–∑–Ω–∞—á–∞—î —Å–ª–æ–≤–æ '–≥–µ—Ä–±–∞—Ç–∞'?", "options": ["–ß–∞–π", "–ì–µ—Ä–±", "–¢—Ä–∞–≤–∞"], "answer": "–ß–∞–π"},
    {"id": 57, "question": "–•—Ç–æ —Ç–∞–∫–∏–π '“ë–∞–∑–¥–∞'?", "options": ["–ì—ñ—Å—Ç—å", "–ì–æ—Å–ø–æ–¥–∞—Ä", "–í–æ–¥—ñ–π"], "answer": "–ì–æ—Å–ø–æ–¥–∞—Ä"},
    {"id": 58, "question": "–©–æ —Ç–∞–∫–µ '“ë—Ä–∏—Å'?", "options": ["–†–∏—Å", "–í–∏—Å—ñ–≤–∫–∏/–ú–∞–Ω–Ω–∞ –∫—Ä—É–ø–∞", "–ì—Ä–∞–≤—ñ–π"],
     "answer": "–í–∏—Å—ñ–≤–∫–∏/–ú–∞–Ω–Ω–∞ –∫—Ä—É–ø–∞"},
    {"id": 59, "question": "–©–æ —Ç–∞–∫–µ '–¥–≤—ñ—Ä–µ—Ü—å'?", "options": ["–ü–∞–ª–∞—Ü", "–í–æ–∫–∑–∞–ª", "–î–≤—ñ—Ä"], "answer": "–í–æ–∫–∑–∞–ª"},
    {"id": 60, "question": "–©–æ —Ç–∞–∫–µ '–¥–∑–∏“ë–∞—Ä–æ–∫'?", "options": ["–î–∑–∏“ë–∞", "–ì–æ–¥–∏–Ω–Ω–∏–∫", "–°–∏–≥–∞—Ä–µ—Ç–∞"], "answer": "–ì–æ–¥–∏–Ω–Ω–∏–∫"},
    {"id": 61, "question": "–•—Ç–æ —Ç–∞–∫–∏–π '–¥—ñ—Ç–≤–∞–∫'?", "options": ["–î—ñ–¥—É—Å—å", "–î–∏—Ç–∏–Ω–∞/–ú–∞–ª–∏–π", "–ü—Ç–∞—Ö"],
     "answer": "–î–∏—Ç–∏–Ω–∞/–ú–∞–ª–∏–π"},
    {"id": 62, "question": "–©–æ —Ç–∞–∫–µ '–¥—Ä–∞–≥–ª—ñ'?", "options": ["–î—Ä–æ–≤–∞", "–•–æ–ª–æ–¥–µ—Ü—å", "–¶—É–∫–µ—Ä–∫–∏"], "answer": "–•–æ–ª–æ–¥–µ—Ü—å"},
    {"id": 63, "question": "–•—Ç–æ —Ç–∞–∫–∏–π '–∂–æ–≤–Ω—ñ—Ä'?", "options": ["–°–æ–ª–¥–∞—Ç", "–ñ—É–∫", "–ñ—É—Ä–Ω–∞–ª—ñ—Å—Ç"], "answer": "–°–æ–ª–¥–∞—Ç"},
    {"id": 64, "question": "–©–æ –æ–∑–Ω–∞—á–∞—î '–∑–∞—Ñ—É–Ω–¥—É–≤–∞—Ç–∏'?",
     "options": ["–ó–±—É–¥—É–≤–∞—Ç–∏ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç", "–ü—Ä–∏–≥–æ—Å—Ç–∏—Ç–∏ (–∑–∞–ø–ª–∞—Ç–∏—Ç–∏)", "–ó–∞—Å–Ω—É–≤–∞—Ç–∏"], "answer": "–ü—Ä–∏–≥–æ—Å—Ç–∏—Ç–∏ (–∑–∞–ø–ª–∞—Ç–∏—Ç–∏)"},
    {"id": 65, "question": "–©–æ —Ç–∞–∫–µ '–∑–¥–∏–±–∞–Ω–∫–∞'?", "options": ["–ó—É—Å—Ç—Ä—ñ—á", "–°–≤–∞—Ä–∫–∞", "–ó–Ω–∞—Ö—ñ–¥–∫–∞"], "answer": "–ó—É—Å—Ç—Ä—ñ—á"},
    {"id": 66, "question": "–©–æ –æ–∑–Ω–∞—á–∞—î '–∫–∞–ª–∞–ø—É—Ü—è—Ç–∏'?", "options": ["–°–ø—ñ–≤–∞—Ç–∏", "–ü–µ—Ä–µ–º—ñ—à—É–≤–∞—Ç–∏", "–ö—É–ø—É–≤–∞—Ç–∏"],
     "answer": "–ü–µ—Ä–µ–º—ñ—à—É–≤–∞—Ç–∏"},
    {"id": 67, "question": "–•—Ç–æ —Ç–∞–∫–∏–π '–∫–∞–ø—Ü–∞–Ω'?", "options": ["–ë–∞–≥–∞—Ç—ñ–π", "–ö–∞–ø—ñ—Ç–∞–Ω", "–ë—ñ–¥–Ω—è–∫/–ù–µ–≤–¥–∞—Ö–∞"],
     "answer": "–ë—ñ–¥–Ω—è–∫/–ù–µ–≤–¥–∞—Ö–∞"},
    {"id": 68, "question": "–©–æ —Ç–∞–∫–µ ' –∫–µ–ª—ñ—à–æ–∫'?", "options": ["–ß–∞—Ä–∫–∞", "–ö–∏–ª–∏–º–æ–∫", "–ì–æ—Ä—ñ—à–æ–∫"], "answer": "–ß–∞—Ä–∫–∞"},
    {"id": 69, "question": "–©–æ —Ç–∞–∫–µ '–∫–ª—è–º–∫–∞'?", "options": ["–ó–∞–º–æ–∫", "–î–≤–µ—Ä–Ω–∞ —Ä—É—á–∫–∞", "–ö–ª—è–∫—Å–∞"],
     "answer": "–î–≤–µ—Ä–Ω–∞ —Ä—É—á–∫–∞"},
    {"id": 70, "question": "–©–æ —Ç–∞–∫–µ '–∫—Ä–µ–¥–µ–Ω—Å'?", "options": ["–ö—Ä–µ–¥–∏—Ç", "–®–∞—Ñ–∞ –¥–ª—è –ø–æ—Å—É–¥—É/–°–µ—Ä–≤–∞–Ω—Ç", "–ö—Ä—ñ—Å–ª–æ"],
     "answer": "–®–∞—Ñ–∞ –¥–ª—è –ø–æ—Å—É–¥—É/–°–µ—Ä–≤–∞–Ω—Ç"},
    {"id": 71, "question": "–•—Ç–æ —Ç–∞–∫–∏–π '–∫—É–º–ø–µ–ª—å'?", "options": ["–ö—É–º", "–¢–æ–≤–∞—Ä–∏—à/–î—Ä—É–≥", "–°—É—Å—ñ–¥"],
     "answer": "–¢–æ–≤–∞—Ä–∏—à/–î—Ä—É–≥"},
    {"id": 72, "question": "–•—Ç–æ —Ç–∞–∫–∏–π '–ª–µ–≥—ñ–Ω—å'?", "options": ["–õ–µ–¥–∞—Ä", "–ü–∞—Ä—É–±–æ–∫", "–õ–µ–≥–∫–æ–∞—Ç–ª–µ—Ç"], "answer": "–ü–∞—Ä—É–±–æ–∫"},
    {"id": 73, "question": "–©–æ –æ–∑–Ω–∞—á–∞—î '–ª—é—Ñ—Ç—É–≤–∞—Ç–∏'?", "options": ["–õ—ñ—Ç–∞—Ç–∏", "–ü—Ä–æ–≤—ñ—Ç—Ä—é–≤–∞—Ç–∏", "–õ—é–±–∏—Ç–∏"],
     "answer": "–ü—Ä–æ–≤—ñ—Ç—Ä—é–≤–∞—Ç–∏"},
    {"id": 74, "question": "–©–æ —Ç–∞–∫–µ '–º–∞–π—Ç–∫–∏'?", "options": ["–ö–≤—ñ—Ç–∏", "–¢—Ä—É—Å–∏", "–ú–∞–π–∫–∏"], "answer": "–¢—Ä—É—Å–∏"},
    {"id": 75, "question": "–•—Ç–æ —Ç–∞–∫–∞ '–º–∞–Ω—Ç–∏–ª–µ–ø–∞'?", "options": ["–ú–æ–¥–Ω–∏—Ü—è", "–ù–µ–æ—Ö–∞–π–Ω–∞ –∂—ñ–Ω–∫–∞", "–í—á–∏—Ç–µ–ª—å–∫–∞"],
     "answer": "–ù–µ–æ—Ö–∞–π–Ω–∞ –∂—ñ–Ω–∫–∞"},
    {"id": 76, "question": "–©–æ —Ç–∞–∫–µ '–º–∞—Ç—É—Ä–∞'?", "options": ["–ú–∞—Ç–∏", "–ê—Ç–µ—Å—Ç–∞—Ç/–Ü—Å–ø–∏—Ç –∑—Ä—ñ–ª–æ—Å—Ç—ñ", "–ü–æ–¥–æ—Ä–æ–∂"],
     "answer": "–ê—Ç–µ—Å—Ç–∞—Ç/–Ü—Å–ø–∏—Ç –∑—Ä—ñ–ª–æ—Å—Ç—ñ"},
    {"id": 77, "question": "–©–æ –æ–∑–Ω–∞—á–∞—î '–Ω—ñ—Ü'?", "options": ["–ù—ñ—á", "–ù—ñ—á–æ–≥–æ", "–ù–∏–∑—å–∫–æ"], "answer": "–ù—ñ—á–æ–≥–æ"},
    {"id": 78, "question": "–©–æ —Ç–∞–∫–µ '–æ–±—Ü–∞—Å–∏'?", "options": ["–ü—ñ–¥–±–æ—Ä–∏", "–û–±—Ü–µ–Ω—å–∫–∏", "–ü—Ä–∏–∫—Ä–∞—Å–∏"], "answer": "–ü—ñ–¥–±–æ—Ä–∏"},
    {"id": 79, "question": "–•—Ç–æ —Ç–∞–∫–∏–π '–æ—Ñ–µ—Ä–º–∞'?", "options": ["–§–µ—Ä–º–µ—Ä", "–ù–µ–∑–≥—Ä–∞–±–∞", "–û—Ñ—ñ—Ü–µ—Ä"], "answer": "–ù–µ–∑–≥—Ä–∞–±–∞"},
    {"id": 80, "question": "–©–æ —Ç–∞–∫–µ '–ø–∞–Ω—Ç–æ—Ñ–ª—ñ'?", "options": ["–¢—É—Ñ–ª—ñ", "–ö—ñ–º–Ω–∞—Ç–Ω—ñ –∫–∞–ø—Ü—ñ", "–®—Ç–∞–Ω–∏"],
     "answer": "–ö—ñ–º–Ω–∞—Ç–Ω—ñ –∫–∞–ø—Ü—ñ"},
    {"id": 81, "question": "–©–æ –æ–∑–Ω–∞—á–∞—î '–ø–∞—Ä–∞–¥–æ–≤–∞—Ç–∏—Å—è'?", "options": ["–ô—Ç–∏ –Ω–∞ –ø–∞—Ä–∞–¥", "–ü–∏—à–∞—Ç–∏—Å—è/–¢—ñ—à–∏—Ç–∏—Å—è", "–ü—Ä–æ–¥–∞–≤–∞—Ç–∏"],
     "answer": "–ü–∏—à–∞—Ç–∏—Å—è/–¢—ñ—à–∏—Ç–∏—Å—è"},
    {"id": 82, "question": "–©–æ —Ç–∞–∫–µ '–ø–∞—Ü—å–æ—Ä–∫–∏'?", "options": ["–ú–æ–ª–∏—Ç–≤–∏", "–ù–∞–º–∏—Å—Ç–æ", "–ü–∞–ª–∏—Ü—ñ"], "answer": "–ù–∞–º–∏—Å—Ç–æ"},
    {"id": 83, "question": "–©–æ –Ω–∞–∑–∏–≤–∞—é—Ç—å '–ø–∏—Ä–æ–≥–∞–º–∏' –Ω–∞ –ì–∞–ª–∏—á–∏–Ω—ñ?", "options": ["–¢–æ—Ä—Ç–∏", "–í–∞—Ä–µ–Ω–∏–∫–∏", "–ë—É–ª–æ—á–∫–∏"],
     "answer": "–í–∞—Ä–µ–Ω–∏–∫–∏"},
    {"id": 84, "question": "–©–æ —Ç–∞–∫–µ '–ø–∏—Å–æ–∫'?", "options": ["–ü—ñ—Å–æ–∫", "–†–æ—Ç/–û–±–ª–∏—á—á—è", "–õ–∏—Å—Ç"], "answer": "–†–æ—Ç/–û–±–ª–∏—á—á—è"},
    {"id": 85, "question": "–©–æ —Ç–∞–∫–µ '–ø—É–ª—è—Ä–µ—Å'?", "options": ["–ì–∞–º–∞–Ω–µ—Ü—å", "–ö—É–ª–µ–º–µ—Ç", "–ü–æ—è—Å"], "answer": "–ì–∞–º–∞–Ω–µ—Ü—å"},
    {"id": 86, "question": "–©–æ —Ç–∞–∫–µ '—Ä–∞–π—Ç–∫–∏'?", "options": ["–®—Ç–∞–Ω–∏ (–≥–∞–ª—ñ—Ñ–µ)", "–ü–æ—Ä–∞–¥–∏", "–†–∞–π–¥—É–≥–∞"],
     "answer": "–®—Ç–∞–Ω–∏ (–≥–∞–ª—ñ—Ñ–µ)"},
    {"id": 87, "question": "–©–æ —Ç–∞–∫–µ '—Ä–∞–Ω–¥–∫–∞'?", "options": ["–†–∞–Ω–æ–∫", "–ü–æ–±–∞—á–µ–Ω–Ω—è", "–†–∞–Ω–∞"], "answer": "–ü–æ–±–∞—á–µ–Ω–Ω—è"},
    {"id": 88, "question": "–©–æ —Ç–∞–∫–µ '—Å–∫–ª–µ–ø'?", "options": ["–ü—ñ–¥–∑–µ–º–µ–ª–ª—è", "–ú–∞–≥–∞–∑–∏–Ω", "–°–∫—Ä—ñ–ø–∫–∞"], "answer": "–ú–∞–≥–∞–∑–∏–Ω"},
    {"id": 89, "question": "–©–æ —Ç–∞–∫–µ '—Å–ø–æ–¥–Ω—ñ'?", "options": ["–®—Ç–∞–Ω–∏/–ë—ñ–ª–∏–∑–Ω–∞", "–°–ø–æ–≥–∞–¥–∏", "–°–ø—ñ–¥–Ω–∏—Ü—ñ"],
     "answer": "–®—Ç–∞–Ω–∏/–ë—ñ–ª–∏–∑–Ω–∞"},
    {"id": 90, "question": "–©–æ —Ç–∞–∫–µ '—Ç–æ—Ä–±–∞'?", "options": ["–°—É–º–∫–∞", "–¢—Ä—É–±–∞", "–ì–æ–ª–æ–≤–∞"], "answer": "–°—É–º–∫–∞"},
    {"id": 91, "question": "–•—Ç–æ —Ç–∞–∫–∏–π '—Ñ–∞—Ü–µ—Ç'?", "options": ["–°–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç", "–ß–æ–ª–æ–≤—ñ–∫/–ü–∞—Ä—É–±–æ–∫", "–§–∞—Å–∞–¥"],
     "answer": "–ß–æ–ª–æ–≤—ñ–∫/–ü–∞—Ä—É–±–æ–∫"},
    {"id": 92, "question": "–©–æ —Ç–∞–∫–µ '—Ñ–ª—è—à–∫–∞'?", "options": ["–ü–ª—è—à–∫–∞", "–§–ª–µ—à–∫–∞", "–ö–æ–≤–±–∞—Å–∞"], "answer": "–ü–ª—è—à–∫–∞"},
    {"id": 93, "question": "–•—Ç–æ —Ç–∞–∫–∏–π '—Ñ—Ä–∞—ó—Ä'?", "options": ["–í—ñ–ª—å–Ω–∞ –ª—é–¥–∏–Ω–∞", "–ó–∞–ª–∏—Ü—è–ª—å–Ω–∏–∫/–ö–∞–≤–∞–ª–µ—Ä", "–ü–µ—Ä—É–∫–∞—Ä"],
     "answer": "–ó–∞–ª–∏—Ü—è–ª—å–Ω–∏–∫/–ö–∞–≤–∞–ª–µ—Ä"},
    {"id": 94, "question": "–©–æ —Ç–∞–∫–µ '—Ü–≤—ñ–∫–ª—ñ'?", "options": ["–¶–≤—è—Ö–∏", "–ë—É—Ä—è–∫ –∑ —Ö—Ä—ñ–Ω–æ–º", "–ö–≤—ñ—Ç–∏"],
     "answer": "–ë—É—Ä—è–∫ –∑ —Ö—Ä—ñ–Ω–æ–º"},
    {"id": 95, "question": "–•—Ç–æ —Ç–∞–∫–∏–π '—à–≤–∞“ë–µ—Ä'?", "options": ["–ë—Ä–∞—Ç –¥—Ä—É–∂–∏–Ω–∏/–ß–æ–ª–æ–≤—ñ–∫ —Å–µ—Å—Ç—Ä–∏", "–ö—Ä–∞–≤–µ—Ü—å", "–®–≤–µ—Ü—å"],
     "answer": "–ë—Ä–∞—Ç –¥—Ä—É–∂–∏–Ω–∏/–ß–æ–ª–æ–≤—ñ–∫ —Å–µ—Å—Ç—Ä–∏"},
    {"id": 96, "question": "–©–æ —Ç–∞–∫–µ '—à–æ–≤–∫–æ–≤–∞'?", "options": ["–¢–∫–∞–Ω–∏–Ω–∞", "–®–æ–≤–∫–æ–≤–∏—Ü—è (—è–≥–æ–¥–∞)", "–°—É–∫–Ω—è"],
     "answer": "–®–æ–≤–∫–æ–≤–∏—Ü—è (—è–≥–æ–¥–∞)"},
    {"id": 97, "question": "–©–æ —Ç–∞–∫–µ '—à–ø–∏—Ç–∞–ª—å'?", "options": ["–®–∫–æ–ª–∞", "–õ—ñ–∫–∞—Ä–Ω—è", "–ì–æ—Ç–µ–ª—å"], "answer": "–õ—ñ–∫–∞—Ä–Ω—è"},
    {"id": 98, "question": "–©–æ —Ç–∞–∫–µ '—à—Ç—Ä–µ–∫–∞'?", "options": ["–°—Ç—Ä—ñ—á–∫–∞", "–ó–∞–ª—ñ–∑–Ω–∏—Ü—è/–ö–æ–ª—ñ—è", "–®—Ç—Ä–∏—Ö-–∫–æ–¥"],
     "answer": "–ó–∞–ª—ñ–∑–Ω–∏—Ü—è/–ö–æ–ª—ñ—è"},
    {"id": 99, "question": "–©–æ —Ç–∞–∫–µ '—è—Ä–∏–Ω–∏'?", "options": ["–û–≤–æ—á—ñ", "–Ø—Ä–∏", "–§—Ä—É–∫—Ç–∏"], "answer": "–û–≤–æ—á—ñ"},
    {"id": 100, "question": "–©–æ —Ç–∞–∫–µ '—è—Å—å–∫–∏'?", "options": ["–ü–æ–¥—É—à–∫–∏", "–í–µ–ª–∏–∫–∞ –∫–≤–∞—Å–æ–ª—è", "–Ø—Å–ª–∞"],
     "answer": "–í–µ–ª–∏–∫–∞ –∫–≤–∞—Å–æ–ª—è"}
]

REGISTRATION_TEMPLATE = """
<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üá∫üá¶ –ú–æ–≤–Ω–µ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è üá∫üá¶</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- –ú–ê–°–®–¢–ê–ë–ù–ò–ô –§–Ü–ö–° –î–õ–Ø –ú–û–ë–Ü–õ–¨–ù–ò–• (–©–û–ë –ù–ï –ë–£–õ–û –°–ò–ù–¨–û–ì–û) --- */
        * {
            -webkit-tap-highlight-color: transparent; /* –í–∏–º–∏–∫–∞—î —Å–∏–Ω—î –ø—ñ–¥—Å–≤—ñ—á—É–≤–∞–Ω–Ω—è –ø—Ä–∏ –∫–ª—ñ–∫—É */
            -webkit-touch-callout: none; /* –í–∏–º–∏–∫–∞—î –º–µ–Ω—é –ø—Ä–∏ –¥–æ–≤–≥–æ–º—É –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ */
        }
        body {
            /* –ó–∞–±–æ—Ä–æ–Ω—è—î–º–æ –≤–∏–¥—ñ–ª–µ–Ω–Ω—è —Ç–µ–∫—Å—Ç—É –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        /* –ê–ª–µ –¥–æ–∑–≤–æ–ª—è—î–º–æ –≤–≤–æ–¥–∏—Ç–∏ —Ç–µ–∫—Å—Ç –≤ —ñ–Ω–ø—É—Ç–∞—Ö */
        input {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }
        /* –ü—Ä–∏–±–∏—Ä–∞—î–º–æ —Å–∏–Ω—é —Ä–∞–º–∫—É —Ñ–æ–∫—É—Å—É */
        button:focus, input:focus {
            outline: none;
        }
        /* ------------------------------------------------------------- */

        :root {
            /* Light Theme */
            --bg-gradient-start: #0057B7;
            --bg-gradient-end: #FFD700;
            --container-bg: white;
            --text-color: #333;
            --title-color: #0057B7;
            --subtitle-color: #666;
            --input-border: #e9ecef;
            --input-focus: #0057B7;
            --input-bg: white;
            --input-text: #333;
        }

        body.dark-mode {
            /* Dark Theme */
            --bg-gradient-start: #141E30;
            --bg-gradient-end: #243B55;
            --container-bg: #2d3436;
            --text-color: #ecf0f1;
            --title-color: #74b9ff;
            --subtitle-color: #bdc3c7;
            --input-border: #636e72;
            --input-focus: #74b9ff;
            --input-bg: #636e72;
            --input-text: white;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
            padding: 20px;
            color: var(--text-color);
            box-sizing: border-box;
            transition: background 0.5s ease;
        }

        .beta-badge {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.3);
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            color: white;
            letter-spacing: 1px;
            text-transform: uppercase;
            backdrop-filter: blur(5px);
            z-index: 100;
        }

        .registration-container {
            background: var(--container-bg);
            width: 100%;
            max-width: 450px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            padding: 30px;
            text-align: center;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .game-title {
            font-size: 28px;
            color: var(--title-color);
            margin-bottom: 10px;
            font-weight: 700;
        }

        .game-subtitle {
            font-size: 16px;
            color: var(--subtitle-color);
            margin-bottom: 30px;
        }

        .input-group {
            margin-bottom: 20px;
            text-align: left;
            width: 100%;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 2px solid var(--input-border);
            border-radius: 10px;
            box-sizing: border-box;
            transition: border-color 0.3s;
            background: var(--input-bg);
            color: var(--input-text);
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--input-focus);
        }

        .register-btn {
            background: #FFD700;
            color: #0057B7;
            border: none;
            padding: 15px;
            font-size: 18px;
            font-weight: 700;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
            width: 100%;
            margin-top: 10px;
            transition: all 0.3s;
        }

        .register-btn:hover {
            background: #FFC700;
            transform: translateY(-2px);
        }

        .error-message {
            color: #dc3545;
            font-size: 14px;
            margin-top: 10px;
            display: none;
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: transform 0.3s;
        }

        .theme-toggle:hover {
            transform: rotate(30deg);
            background: rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>

<div class="beta-badge">–ë–ï–¢–ê –¢–ï–°–¢–£–í–ê–ù–ù–Ø</div>

<div class="registration-container">
    <button class="theme-toggle" onclick="toggleTheme()">üåì</button>
    <div class="game-title">üá∫üá¶ –ú–æ–≤–Ω–µ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è üá∫üá¶</div>
    <div class="game-subtitle">–ó–∞—Ö—ñ–¥–Ω–∞ “ê–≤–∞—Ä–∞ - –í–µ–ª–∏–∫–∞ –≤—ñ–∫—Ç–æ—Ä–∏–Ω–∞</div>

    <form method="POST" action="/" onsubmit="return validateForm()">
        <div class="input-group">
            <label for="name">–í–∞—à–µ —ñ–º'—è:</label>
            <input type="text" id="name" name="name" placeholder="–í–≤–µ–¥—ñ—Ç—å –≤–∞—à–µ —ñ–º'—è" required>
        </div>

        <div class="input-group">
            <label for="email">–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ø–æ—à—Ç–∞:</label>
            <input type="email" id="email" name="email" placeholder="example@email.com" required>
        </div>

        <button type="submit" class="register-btn">–†–æ–∑–ø–æ—á–∞—Ç–∏ –≥—Ä—É üéÆ</button>
        <div class="error-message" id="error-msg">–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è!</div>
    </form>
</div>

<script>
    // Theme Logic
    function toggleTheme() {
        document.body.classList.toggle('dark-mode');
        const theme = document.body.classList.contains('dark-mode') ? 'dark' : 'light';
        localStorage.setItem('theme', theme);
    }

    // Init Theme
    if (localStorage.getItem('theme') === 'dark') {
        document.body.classList.add('dark-mode');
    }

    function validateForm() {
        const name = document.getElementById('name').value.trim();
        const email = document.getElementById('email').value.trim();
        const errorMsg = document.getElementById('error-msg');

        if (name === '' || email === '') {
            errorMsg.style.display = 'block';
            return false;
        }

        return true;
    }
</script>

</body>
</html>
"""

HTML_TEMPLATE = """
<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üá∫üá¶ –ú–æ–≤–Ω–µ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è üá∫üá¶</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- –ú–ê–°–®–¢–ê–ë–ù–ò–ô –§–Ü–ö–° –î–õ–Ø –ú–û–ë–Ü–õ–¨–ù–ò–• (–ì–†–ê) --- */
        * {
            -webkit-tap-highlight-color: transparent; /* –í–∏–º–∏–∫–∞—î —Å–∏–Ω—î –ø—ñ–¥—Å–≤—ñ—á—É–≤–∞–Ω–Ω—è –ø—Ä–∏ –∫–ª—ñ–∫—É */
            -webkit-touch-callout: none; /* –í–∏–º–∏–∫–∞—î –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–µ –º–µ–Ω—é */
        }
        body {
            -webkit-user-select: none; /* –ó–∞–±–æ—Ä–æ–Ω–∞ –≤–∏–¥—ñ–ª–µ–Ω–Ω—è —Ç–µ–∫—Å—Ç—É */
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        input, textarea {
            -webkit-user-select: text; /* –î–æ–∑–≤—ñ–ª –ø–∏—Å–∞—Ç–∏ –≤ —ñ–Ω–ø—É—Ç–∞—Ö */
            user-select: text;
        }
        /* –ì–ª–æ–±–∞–ª—å–Ω–µ –≤–∏–º–∫–Ω–µ–Ω–Ω—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ—ó —Ä–∞–º–∫–∏ —Ñ–æ–∫—É—Å—É */
        button:focus, button:active, .option-btn:focus, .option-btn:active, #next-btn:focus, input:focus {
            outline: none !important;
            box-shadow: none !important;
        }
        /* ----------------------------------------- */

        :root {
            /* Light Theme */
            --bg-start: #11998e;
            --bg-end: #38ef7d;
            --card-bg: white;
            --text-color: #333;
            --header-color: #0057B7;
            --greeting-bg: #f1f2f6;
            --greeting-text: #666;
            --option-bg: #f8f9fa;
            --option-border: #e9ecef;
            --option-hover: #e3f2fd;
            /* --option-hover-border: #2196f3;  <-- –í–ò–î–ê–õ–ò–õ–ò –°–ò–ù–Æ –û–ë–í–û–î–ö–£ */
            --modal-bg: white;
            --modal-text: #333;
            --input-bg: white;
            --input-text: #333;
            --input-border: #ddd;
        }

        body.dark-mode {
            /* Dark Theme */
            --bg-start: #0f2027;
            --bg-end: #203a43;
            --card-bg: #2d3436;
            --text-color: #ecf0f1;
            --header-color: #74b9ff;
            --greeting-bg: #636e72;
            --greeting-text: #dfe6e9;
            --option-bg: #636e72;
            --option-border: #555;
            --option-hover: #0984e3;
            /* --option-hover-border: #74b9ff; <-- –í–ò–î–ê–õ–ò–õ–ò –°–ò–ù–Æ –û–ë–í–û–î–ö–£ */
            --modal-bg: #2d3436;
            --modal-text: #ecf0f1;
            --input-bg: #636e72;
            --input-text: white;
            --input-border: #555;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, var(--bg-start) 0%, var(--bg-end) 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin: 0;
            color: var(--text-color);
            padding: 10px;
            box-sizing: border-box;
            transition: background 0.5s ease, color 0.3s ease;
        }

        .beta-badge {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            color: #333333;
            letter-spacing: 1px;
            text-transform: uppercase;
            backdrop-filter: blur(5px);
            z-index: 100;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .game-container {
            background: var(--card-bg);
            width: 100%;
            max-width: 500px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            padding: 20px;
            text-align: center;
            display: flex;
            flex-direction: column;
            position: relative;
            transition: background 0.3s ease;
        }

        .users-counter {
            background: #FFD700;
            color: #0057B7;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
            box-shadow: 0 3px 10px rgba(255, 215, 0, 0.4);
            transition: all 0.3s;
            align-self: center;
            margin-bottom: 15px;
            display: inline-block;
        }

        .users-counter:hover {
            transform: scale(1.05);
        }

        .theme-toggle {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: transform 0.3s;
            z-index: 10;
        }

        .theme-toggle:hover {
            transform: rotate(30deg);
            background: rgba(255,255,255,0.1);
        }

        .game-header {
            font-size: 24px;
            color: var(--header-color);
            margin-bottom: 15px;
            font-weight: 700;
            line-height: 1.2;
        }

        .user-greeting {
            font-size: 16px;
            color: var(--greeting-text);
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
            background: var(--greeting-bg);
            padding: 10px;
            border-radius: 10px;
            transition: background 0.3s ease;
        }

        .profile-btn {
            background: #0057B7;
            color: white;
            border: none;
            padding: 8px 20px;
            font-size: 14px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            width: 100%;
        }

        .profile-btn:hover {
            background: #003d82;
            transform: translateY(-2px);
        }

        .admin-btn {
            background: #0088cc;
            color: white;
            text-decoration: none;
            padding: 8px 20px;
            font-size: 14px;
            border-radius: 20px;
            font-weight: 600;
            display: block;
            width: 100%;
            box-sizing: border-box;
            transition: all 0.3s;
            text-align: center;
        }

        .admin-btn:hover {
            background: #0077b5;
            transform: translateY(-2px);
        }

        h2 {
            color: var(--text-color);
            margin-bottom: 20px;
            margin-top: 10px;
            font-size: 20px;
            line-height: 1.4;
        }

        .options-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
        }

        .option-btn {
            background: var(--option-bg);
            border: 2px solid var(--option-border);
            padding: 12px;
            border-radius: 12px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            color: var(--text-color);
            width: 100%;
            white-space: normal;
        }

        /* --- FIX: –ó–ê–°–¢–û–°–û–í–£–Ñ–ú–û HOVER –¢–Ü–õ–¨–ö–ò –ù–ê –ü–†–ò–°–¢–†–û–Ø–• –ó –ú–ò–®–ö–û–Æ (–ü–ö) --- */
        @media (hover: hover) {
            .option-btn:hover {
                background: var(--option-hover);
                /* border-color: transparent; */ /* –ü—Ä–∏–±—Ä–∞–ª–∏ –∑–º—ñ–Ω—É –∫–æ–ª—å–æ—Ä—É –±–æ—Ä–¥–µ—Ä–∞ */
                color: var(--text-color);
            }
        }

        .option-btn.correct {
            background: #d4edda !important;
            border-color: #28a745 !important;
            color: #155724 !important;
        }

        .option-btn.wrong {
            background: #f8d7da !important;
            border-color: #dc3545 !important;
            color: #721c24 !important;
            opacity: 0.7;
        }

        .progress-container {
            width: 100%;
            background-color: #e9ecef;
            border-radius: 10px;
            margin-bottom: 20px;
            height: 8px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background-color: #2ecc71;
            width: 0%;
            transition: width 0.5s ease;
        }

        #next-btn {
            display: none;
            width: 100%;
            margin-top: 20px;
            padding: 12px;
            background-color: #0984e3;
            color: white;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(9, 132, 227, 0.4);
            animation: popIn 0.3s ease-out;
        }

        #next-btn:hover {
            background-color: #74b9ff;
        }

        .start-btn {
            background: #ff7675;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(255, 118, 117, 0.4);
            width: 100%;
        }

        .start-btn:hover {
            background: #e17055;
        }

        .footer {
            margin-top: 20px;
            text-align: center;
            color: white;
            font-size: 12px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            line-height: 1.5;
            padding: 0 10px;
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ñ –≤—ñ–∫–Ω–∞ */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            padding: 10px;
            box-sizing: border-box;
            overflow-y: auto;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: var(--modal-bg);
            color: var(--modal-text);
            margin: auto;
            padding: 20px;
            border-radius: 20px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
            transition: background 0.3s ease;
        }

        .close-modal {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 20px;
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è —ñ–Ω–ø—É—Ç—ñ–≤ —É –º–æ–¥–∞–ª—Ü—ñ */
        .modal-content input {
            background-color: var(--input-bg);
            color: var(--input-text);
            border: 1px solid var(--input-border);
        }

        .social-links {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }

        .social-btn {
            width: 100%;
            text-align: center;
            box-sizing: border-box;
        }

        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>

<div class="beta-badge">–ë–ï–¢–ê –¢–ï–°–¢–£–í–ê–ù–ù–Ø</div>

<div class="game-container">
    <button class="theme-toggle" onclick="toggleTheme()">üåì</button>

    <div class="users-counter" onclick="adminLogin()">
        üë•
    </div>

    <div class="game-header">üá∫üá¶ –ú–æ–≤–Ω–µ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è üá∫üá¶</div>

    <div class="user-greeting">
        <span>–í—ñ—Ç–∞—î–º–æ, <strong><span id="display-name">{{ user_name }}</span></strong>!</span>
        <button class="profile-btn" onclick="openProfile()">üë§ –ü—Ä–æ—Ñ—ñ–ª—å</button>
        <a href="https://t.me/Nazar_la" target="_blank" class="admin-btn">‚úàÔ∏è –ù–∞–ø–∏—Å–∞—Ç–∏ –∞–¥–º—ñ–Ω—É</a>
    </div>

    <div id="start-screen">
        <h2 style="margin: 0 0 15px 0;">–ó–∞—Ö—ñ–¥–Ω–∞ “ê–≤–∞—Ä–∞</h2>
        <p style="font-size: 16px; margin-bottom: 20px;">–í–µ–ª–∏–∫–∞ –≤—ñ–∫—Ç–æ—Ä–∏–Ω–∞ (<span id="total-q">50</span> –ø–∏—Ç–∞–Ω—å)</p>
        <button class="start-btn" onclick="startGame()">–ü–æ—á–∞—Ç–∏ –≥—Ä—É</button>
    </div>

    <div id="game-screen" style="display: none;">
        <div class="progress-container">
            <div class="progress-bar" id="progress"></div>
        </div>

        <div id="live-score" style="text-align: center; font-weight: bold; margin: 10px 0; color: var(--text-color); font-size: 16px;">
            0% (‚úÖ 0 | ‚ùå 0)
        </div>

        <h2 id="q-text">–ü–∏—Ç–∞–Ω–Ω—è</h2>

        <div class="options-grid" id="options-area">
            </div>

        <button id="next-btn" onclick="nextQuestion()">–ù–∞—Å—Ç—É–ø–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è ‚û°Ô∏è</button>
    </div>

    <div id="result-screen" style="display: none;">
        <h2 style="font-size: 28px;">–ì—Ä—É –∑–∞–≤–µ—Ä—à–µ–Ω–æ!</h2>
        <div style="font-size: 20px; color: #d35400; margin-bottom: 10px;" id="rank-text">–¢—É—Ä–∏—Å—Ç</div>
        <div style="font-size: 40px; color: #2ecc71; font-weight: bold; margin-bottom: 20px;">
            <span id="score">0</span> / <span id="total-score-q">50</span>
        </div>
        <button class="start-btn" onclick="location.reload()">–°–ø—Ä–æ–±—É–≤–∞—Ç–∏ —â–µ</button>
    </div>

</div>

<div id="profileModal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close-modal" onclick="closeProfile()">√ó</span>
        <h2 style="color: #0057B7; margin-top: 0; font-size: 22px;">üë§ –ü—Ä–æ—Ñ—ñ–ª—å</h2>

        <div class="success-message" id="success-msg" style="display:none; background:#d4edda; padding:10px; margin:10px 0; border-radius:5px; color: #155724;">‚úÖ –û–Ω–æ–≤–ª–µ–Ω–æ!</div>

        <div class="profile-info" id="view-mode">
            <p><strong>–Ü–º'—è:</strong> <br><span id="profile-name">{{ user_name }}</span></p>
            <p><strong>Email:</strong> <br><span id="profile-email">{{ user_email }}</span></p>
            <button class="edit-btn" onclick="toggleEditMode()" style="width:100%; margin: 10px 0; background:#0984e3; color:white; border:none; padding:10px; border-radius:8px;">‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
        </div>

        <div class="edit-section" id="edit-mode">
            <form id="edit-form" onsubmit="return saveProfile(event)">
                <div style="text-align:left; margin-bottom:10px;">
                    <label>–Ü–º'—è:</label>
                    <input type="text" id="edit-name" value="{{ user_name }}" required style="width:100%; padding:8px; border-radius:5px;">
                </div>

                <div style="text-align:left; margin-bottom:10px;">
                    <label>Email:</label>
                    <input type="email" id="edit-email" value="{{ user_email }}" required style="width:100%; padding:8px; border-radius:5px;">
                </div>

                <button type="submit" style="width:100%; background:#00b894; color:white; border:none; padding:10px; border-radius:8px; margin-bottom:5px;">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏</button>
                <button type="button" onclick="toggleEditMode()" style="width:100%; background:#636e72; color:white; border:none; padding:10px; border-radius:8px;">‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            </form>
        </div>

        <div class="game-info" style="font-size:12px; margin-top:15px; color:#888;">
            üìÖ 27 —Å—ñ—á–Ω—è 2026
        </div>

        <h3 style="color: #0057B7; font-size: 16px; margin-top: 15px;">üì± –°–æ—Ü–º–µ—Ä–µ–∂—ñ:</h3>
        <div class="social-links">
            <a href="https://youtube.com/shorts/29DlWrzLCIE?si=ZtrEq-2891jh6tq2" target="_blank" class="social-btn" style="background:#FF0000; color:white; padding:10px; text-decoration:none; border-radius:8px;">
                ‚ñ∂Ô∏è YouTube
            </a>
            <a href="https://www.tiktok.com/@._629587" target="_blank" class="social-btn" style="background:#000000; color:white; padding:10px; text-decoration:none; border-radius:8px;">
                üéµ TikTok
            </a>
        </div>

        <button onclick="logout()" style="width:100%; background:#dc3545; color:white; border:none; padding:10px; border-radius:8px; margin-top:15px;">üö™ –í–∏–π—Ç–∏</button>
    </div>
</div>

<div id="usersListModal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close-modal" onclick="closeUsersList()">√ó</span>
        <h2 style="color: #0057B7; margin-top: 0; font-size: 22px;">üë• –ì—Ä–∞–≤—Ü—ñ</h2>

        <div class="users-list" id="users-list-container" style="text-align:left;">
            </div>
    </div>
</div>

<div class="footer">
    ¬© 2026 –ú–æ–≤–Ω–µ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è ‚Ä¢ –í–∏–≤—á–∞—î–º–æ —Ä—ñ–¥–Ω—É –º–æ–≤—É —Ä–∞–∑–æ–º!<br>
    <a href="https://t.me/Nazar_la" target="_blank" style="color: white; text-decoration: none; font-weight: bold; border-bottom: 1px dashed white; margin-top: 5px; display: inline-block;">
        üí¨ –ù–∞–ø–∏—Å–∞—Ç–∏ –∞–¥–º—ñ–Ω—É
    </a>
</div>

<script>
    const questions = {{ questions|tojson }};
    let currentQuestionIndex = 0;
    let score = 0;
    let canClick = true;

    // --- Admin Feature (Code: 2502) ---
    function adminLogin() {
        let code = prompt("üîí –í–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞:");
        if (code === "2502") {
             fetch('/get-users')
            .then(response => response.json())
            .then(data => {
                alert("üìä –í—Å—å–æ–≥–æ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ –≥—Ä–∞–≤—Ü—ñ–≤: " + data.users.length);
                const container = document.getElementById('users-list-container');
                container.innerHTML = '';
                if (data.users.length === 0) {
                    container.innerHTML = '<div style="text-align: center; padding: 20px;">–°–ø–∏—Å–æ–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π üòî</div>';
                } else {
                    data.users.forEach((user, index) => {
                        const userDiv = document.createElement('div');
                        userDiv.style.background = index === 0 ? '#fff3cd' : (document.body.classList.contains('dark-mode') ? '#636e72' : '#f8f9fa');
                        userDiv.style.padding = '10px';
                        userDiv.style.marginBottom = '5px';
                        userDiv.style.borderRadius = '5px';
                        userDiv.style.borderLeft = index === 0 ? '4px solid #FFD700' : '4px solid #0057B7';
                        const textColor = document.body.classList.contains('dark-mode') ? 'white' : '#2c3e50';
                        const subColor = document.body.classList.contains('dark-mode') ? '#dfe6e9' : '#666';
                        userDiv.innerHTML = `<div><div style="font-weight:bold; color:${textColor};">${user.name}${index === 0 ? '<span style="background:#FFD700; color:#0057B7; padding:2px 6px; border-radius:10px; font-size:10px; margin-left:5px;">‚≠ê</span>' : ''}</div><div style="font-size:11px; color:${subColor};">${user.registered_at}</div></div>`;
                        container.appendChild(userDiv);
                    });
                }
                document.getElementById('usersListModal').style.display = 'flex';
            });
        } else if (code !== null) {
            alert("‚õî –ù–µ–≤—ñ—Ä–Ω–∏–π –ø–∞—Ä–æ–ª—å!");
        }
    }

    // --- Theme Logic ---
    function toggleTheme() {
        document.body.classList.toggle('dark-mode');
        const theme = document.body.classList.contains('dark-mode') ? 'dark' : 'light';
        localStorage.setItem('theme', theme);
    }

    // Init Theme on Load
    if (localStorage.getItem('theme') === 'dark') {
        document.body.classList.add('dark-mode');
    }

    document.addEventListener('DOMContentLoaded', function() {
        const totalSpan = document.getElementById('total-q');
        if(totalSpan) totalSpan.innerText = questions.length;
        const totalScoreSpan = document.getElementById('total-score-q');
        if(totalScoreSpan) totalScoreSpan.innerText = questions.length;
        // Init counter with 0% of TOTAL
        document.getElementById('live-score').innerText = `0% (‚úÖ 0 | ‚ùå 0)`;
    });

    function openProfile() {
        document.getElementById('profileModal').style.display = 'flex';
        document.getElementById('view-mode').style.display = 'block';
        document.getElementById('edit-mode').style.display = 'none';
        document.getElementById('success-msg').style.display = 'none';
    }

    function closeProfile() {
        document.getElementById('profileModal').style.display = 'none';
    }

    function closeUsersList() {
        document.getElementById('usersListModal').style.display = 'none';
    }

    function toggleEditMode() {
        const viewMode = document.getElementById('view-mode');
        const editMode = document.getElementById('edit-mode');
        if (editMode.style.display === 'none') {
            viewMode.style.display = 'none';
            editMode.style.display = 'block';
        } else {
            viewMode.style.display = 'block';
            editMode.style.display = 'none';
        }
    }

    function saveProfile(event) {
        event.preventDefault();
        const newName = document.getElementById('edit-name').value.trim();
        const newEmail = document.getElementById('edit-email').value.trim();
        if (newName === '' || newEmail === '') {
            alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è!');
            return false;
        }
        fetch('/update-profile', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                name: newName,
                email: newEmail
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                document.getElementById('profile-name').innerText = newName;
                document.getElementById('profile-email').innerText = newEmail;
                document.getElementById('display-name').innerText = newName;
                document.getElementById('success-msg').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('success-msg').style.display = 'none';
                }, 3000);
                toggleEditMode();
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ –ø—Ä–æ—Ñ—ñ–ª—é!');
        });
        return false;
    }

    function logout() {
        if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–π—Ç–∏ –∑ –∞–∫–∞—É–Ω—Ç–∞?')) {
            window.location.href = '/logout';
        }
    }

    window.onclick = function(event) {
        const profileModal = document.getElementById('profileModal');
        const usersModal = document.getElementById('usersListModal');
        if (event.target == profileModal) {
            closeProfile();
        }
        if (event.target == usersModal) {
            closeUsersList();
        }
    }

    function startGame() {
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('game-screen').style.display = 'block';
        document.getElementById('total-score-q').innerText = questions.length;
        // Reset and show initial stat
        document.getElementById('live-score').innerText = `0% (‚úÖ 0 | ‚ùå 0)`;
        showQuestion();
    }

    function showQuestion() {
        document.getElementById('next-btn').style.display = 'none';
        const q = questions[currentQuestionIndex];
        const total = questions.length;
        const progressPercent = ((currentQuestionIndex) / total) * 100;
        document.getElementById('progress').style.width = progressPercent + '%';
        document.getElementById('q-text').innerText = q.question;
        const optionsArea = document.getElementById('options-area');
        optionsArea.innerHTML = '';
        canClick = true;
        q.options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(btn, opt, q.answer);
            optionsArea.appendChild(btn);
        });
    }

    function checkAnswer(btn, selected, correct) {
        if (!canClick) return;
        canClick = false;

        if (selected === correct) {
            btn.classList.add('correct');
            score++;
        } else {
            btn.classList.add('wrong');
            const buttons = document.querySelectorAll('.option-btn');
            buttons.forEach(b => {
                if (b.innerText === correct) {
                    b.classList.add('correct');
                }
            });
        }

        // --- NEW LOGIC: GLOBAL PROGRESS ---
        const totalQuestions = questions.length;
        const currentAnswered = currentQuestionIndex + 1; // –°–∫—ñ–ª—å–∫–∏ –ø–∏—Ç–∞–Ω—å –ø—Ä–æ–π–¥–µ–Ω–æ
        const wrong = currentAnswered - score; // –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ = –í—Å—å–æ–≥–æ –ø—Ä–æ–π–¥–µ–Ω–æ - –ü—Ä–∞–≤–∏–ª—å–Ω—ñ

        const percentage = Math.round((currentAnswered / totalQuestions) * 100);

        // –ü–æ–∫–∞–∑—É—î–º–æ: % –ü—Ä–æ–≥—Ä–µ—Å—É (‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ñ | ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ)
        document.getElementById('live-score').innerText = `${percentage}% (‚úÖ ${score} | ‚ùå ${wrong})`;
        // ----------------------------------

        const nextBtn = document.getElementById('next-btn');
        if (currentQuestionIndex === questions.length - 1) {
            nextBtn.innerText = "–ü–æ–¥–∏–≤–∏—Ç–∏—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç üèÜ";
        } else {
            nextBtn.innerText = "–ù–∞—Å—Ç—É–ø–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è ‚û°Ô∏è";
        }
        nextBtn.style.display = 'block';
    }

    function nextQuestion() {
        currentQuestionIndex++;
        if (currentQuestionIndex < questions.length) {
            showQuestion();
        } else {
            showResults();
        }
    }

    function showResults() {
        document.getElementById('game-screen').style.display = 'none';
        document.getElementById('result-screen').style.display = 'block';
        document.getElementById('score').innerText = score;
        const total = questions.length;
        let rank = "";
        if (score === total) rank = "üèÜ –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∏–π –ë–∞—Ç—è—Ä!";
        else if (score >= total * 0.8) rank = "üòé –°–≤—ñ–π —á–æ–ª–æ–≤—ñ–∫ (–ú—ñ—Å—Ü–µ–≤–∏–π)";
        else if (score >= total * 0.5) rank = "üéí –ü–æ–≤–∞–∂–Ω–∏–π —Ç—É—Ä–∏—Å—Ç";
        else rank = "üë∂ –¢–æ–±—ñ —â–µ –≤—á–∏—Ç–∏—Å—å —ñ –≤—á–∏—Ç–∏—Å—å";
        document.getElementById('rank-text').innerText = rank;
    }
</script>

</body>
</html>
"""


@app.route('/', methods=['GET', 'POST'])
def index():
    if request.method == 'POST':
        name = request.form.get('name')
        email = request.form.get('email')

        # –î–æ–¥–∞—î–º–æ –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
        add_user(name, email)

        # –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –¥–∞–Ω—ñ –≤ —Å–µ—Å—ñ—ó
        session['user_name'] = name
        session['user_email'] = email
        session['registered'] = True
        return redirect(url_for('game'))

    if not session.get('registered'):
        return render_template_string(REGISTRATION_TEMPLATE)

    return redirect(url_for('game'))


@app.route('/game')
def game():
    if not session.get('registered'):
        return redirect(url_for('index'))

    user_name = session.get('user_name', '–ì—Ä–∞–≤–µ—Ü—å')
    user_email = session.get('user_email', '')

    return render_template_string(
        HTML_TEMPLATE,
        questions=QUESTIONS,
        user_name=user_name,
        user_email=user_email
    )


@app.route('/get-users')
def get_users():
    users = load_users()
    return jsonify({'users': users})


@app.route('/update-profile', methods=['POST'])
def update_profile():
    data = request.get_json()
    new_name = data.get('name')
    new_email = data.get('email')

    session['user_name'] = new_name
    session['user_email'] = new_email

    users = load_users()
    updated = False
    for user in users:
        if user['email'] == new_email or user['name'] == session.get('user_name'):
            if user['email'] == new_email:
                user['name'] = new_name
                updated = True
                break

    if updated:
        save_users(users)

    return jsonify({'success': True})


@app.route('/logout')
def logout():
    session.clear()
    return redirect(url_for('index'))


if __name__ == '__main__':
    app.run(debug=True, port=5000)
